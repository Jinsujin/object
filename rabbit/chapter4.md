# 4장. 역할, 책임, 협력

> 훌륭한 프로그램을 작성하기 위한 전제조건은 추상화를 정확하게 다루는 능력이다.

<br/>

## 협력

```
사람A -----요청----> 사람B
     <----응답----
```

- 협력은 한 사람이 다른 사람에게 도움을 요청할 때 시작된다.
- 요청 받은 사람은 일을 처리하고 요청한 사람에게 응답한다.
- 협력은 다수의 요청과 응답으로 구성된다.
- 객체들은 동일한 목적을 달성하기 위해 협력한다.
- 훌륭한 객체지향 설계란 조화를 이루며 적극적으로 상호작용 하는 협력적인 객체를 창조하는 것이다.

<br/>

## 책임

어떤 객체가 요청에 대해 대답해 줄 수 있거나, 적절한 행동을 할 의무가 있는 경우 해당 객체가 책임을 가진다고 말한다.

|              | 응답해야하는 요청(message) | 책임              |
| ------------ | -------------------------- | ----------------- |
| 왕 👑        | 재판을 수행하라            | 재판을 수행한다   |
| 토끼🐰       | 목격자를 불러오라          | 목격자를 불러온다 |
| 모자 장수 🎩 | 증인석에 입장하라          | 증언한다          |

```bash
"객체지향 개발에서 가장 중요한 능력은 책임을 능숙하게 소프트웨어 객체에 할당하는 것"
-크레이그 라만(Craig Laman)
```

- 협력 안에서 객체는 다른 객체로부터 요청이 전송됐을 경우에만 자신에게 주어진 책임을 수행한다.
  ```
  [송신자]왕 ----(1.요청)목격자를 부르라-----> [수신자]토끼
                           (2.책임수행)모자장수를 증인석으로 부른다
  ```
- **메시지 전송(message-send)**: 객체가 다른 객체에게 주어진 책임을 수행하도록 요청을 보내는 것
- **송신자**: 메시지를 전송함으로써 협력을 요청하는 객체
- **수신자**: 메시지를 받아 처리하는 객체
- 왕(송신자)은 토끼(수신자)에게 토끼가 이해할 수 있는 메시지를 전송하고, 토끼는 그 메시지에 대한 적절한 책임을 수행할 수 있기 때문에 왕과 토끼는 협력할 수 있다.

<br/>

## 역할

재사용 가능하고 유연한 객체지향 설계를 위한 중요한 구성요소

재판 과정:

```bash
──재판요청──>(왕)재판시작
            └────증인요청────>(토끼)
                             └──증인석 입장요청──>(모자장수)증인석 입장
```

- “모자장수”는 증인석에 입장함으로써 토끼의 요청에 응답한다.
  - 이 응답은 “토끼"에 대한 “왕”의 요청에 대한 응답이라고도 할 수 있다.

```bash
* 왕──토끼──모자 장수
* 왕──토끼──요리사
* 여왕──토끼──앨리스
```

- 위의 3 객체의 협력은 모두 유사한 협력관계를 이룬다.
- 협력의 과정이 유사하다면 하나의 협력으로 다룰 수 있다.

```bash
─(message)재판요청──>[판사]
                    └─(message)증인요청──>(토끼)
                                         └─(message)증인석 입장요청──>[증인]증인석 입장
```

- 역할(role)을 사용하면 하나의 협력으로 추상화 할 수 있다.
- “판사" 역할을 할 수 있다면 하트왕, 하트여왕이 이를 대신할 수 있다.
- 즉, 역할을 수행할 수 있는 어떤 객체라도 협력에 참여할 수 있다.(다른 객체로 대체 가능)

  ```swift
  protocol 판사 {
  	func 증인요청(토끼)
  }

  protocol 토끼 {
  	func 증인석입장요청(증인)
  }

  protocol 증인 {
  	func 증인석입장()
  }
  ```

- 객체가 동일한 역할을 수행할 수 있는 것은 메시지를 동일하게 이해하고 처리할 수 있기 때문이다.
- 장점
  - 다양한 객체들이 동일한 협력에 참여할 수 있기때문에 유연해지며, 재사용성을 높일 수 있다.

### 협력 설계

- 객체를 독립적으로 바라보지 말고, 객체가 참여하는 협력을 우선적으로 고려해야 한다.

1. 객체에게 책임 할당(책임: 외부에 제공할 행동)
2. 객체가 행동(책임)을 수행하는데 필요한 데이터 고민
3. 클래스의 구현 방법 결정

클래스와 데이터는 협력과 책임의 집합이 결정된 후에야 무대 위에 등장할 수 있다.

협력에 필요한 책임을 결정하고 객체에게 책임을 할당하는 과정이 적절하게 수행했는지가 설계의 품질을 결정한다.

### 객체지향 설계에서 중요한 점

- 객체가 가져야 하는 상태와 행위에 대해 고민하기 전에 그 객체가 참여할 문맥인 협력을 먼저 정의하라.
- 자율적인 동시에 충분히 협력적인 객체를 창조하라.
- 객체를 충분히 협력적으로 만든 후에 협력이라는 문맥안에서 객체를 충분히 자율적으로 만들라.

<br/>

## 객체지향 설계 기법

1. 책임 주도 설계(Responsibility-Driven Design)
   - 협력에 필요한 책임들을 식별하고 적합한 객체에게 책임을 할당하는 방식
2. Design Pattern
   - 특정한 상황에 사용 가능한 역할, 책임, 협력의 설계 템플릿 모음
3. 테스트 주도 개발(Test-Driven Development)
   - 테스트 작성에 초점이 맞춰진게 아니다.
   - 책임을 구행할 객체 또는 클라이언트가 기대하는 객체의 역할이 메시지를 수신할 떄 어떤 결과를 반환하고 그 과정에서 어떤 객체와 렵력할 것인지에 대한 기대를 코드의 형태로 작성하는 것
   - 스텁(Stub): 테스트에 필요한 간접 입력값을 제공
   - 목 객체(mock object): 간접 출력값을 검증하기 위해 사용
